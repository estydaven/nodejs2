var flip=(function(){var flipper=document.querySelector(".flipper"),btn=document.querySelector(".c-button");var _login=function(){btn.style.display="none";flipper.style.transform="rotateY(180deg)";};var _user=function(){btn.style.display="block";flipper.style.transform="rotateY(0deg)";};return{On:_login,Off:_user}})();var btnOn=document.querySelector(".c-button"),btnOff=document.querySelector(".return-btn");if(btnOn!==null){btnOn.onclick=function(){flip.On();};btnOff.onclick=function(){flip.Off();};}
var Validation=(function(){var errorField=document.querySelector('.input-error-msg'),captchaError=document.querySelector('.welcome__error'),formContainer=document.querySelector('.form__container');var _init=function(form){var elems=form.elements;console.log(elems);return _validate(elems)?true:false;};function _validate(inputs){for(var i=0;i<inputs.length;i++){if(inputs[i].tagName==='BUTTON')continue;var elem=inputs[i];if(elem.value==''){console.log(elem);return _showError(elem)}
if(elem.type==='checkbox'||elem.type==='radio'){if(elem.checked&&elem.value==='yes'){return true;}
if(!elem.checked){captchaError.style.display='flex';}}}
return true;};function _showError(elem){var text=elem.getAttribute('placeholder').toLowerCase();var position=elem.parentNode.offsetTop+elem.parentNode.offsetHeight;elem.parentNode.classList.add('input-group_error');errorField.style.display='block';errorField.innerText='Вы не ввели '+text;errorField.style.top=position+'px';}
function _clearError(elem){console.log(elem);elem.parentNode.classList.remove('input-group_error');errorField.style.display='none';}
return{init:_init,clear:_clearError}})();$(document).ready(function(){$('#toggle').click(function(){$(this).toggleClass('active');$('#overlay').toggleClass('open');});});var headerParallax=(function(){var bg=document.querySelector('.bg-parallax');var user=document.querySelector('.user__hero-parallax');var starsSection=document.querySelector('.stars-parallax');var _move=function(block,windowScroll,strafeAmount){var strafe=windowScroll/-strafeAmount+'%';var transformString='translate3d(0, '+strafe+', 0)';var style=block.style;if(windowScroll<window.innerHeight){style.transform=transformString;style.webkitTransform=transformString;}};return{init:function(wScroll){_move(bg,wScroll,45);_move(user,wScroll,7);_move(starsSection,wScroll,30);}}})();function initMap(){var map=new google.maps.Map(document.getElementById('map'),{zoom:13,center:{lat:53.658348,lng:23.786986},disableDefaultUI:true,scrollwheel:false,styles:[{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#4369aa"},{"visibility":"on"}]}]});var marker=new google.maps.Marker({icon:'assets/img/map-contact.png',position:{lat:53.658348,lng:23.786986},map:map,title:"Я здесь!",animation:google.maps.Animation.BOUNCE});}
var BlogMenu=(function(){var sidebar=document.querySelector('.blog__tabs');function _fixMenu(){var nav=document.querySelector('.blog__tabs-list'),navCoords=sidebar.getBoundingClientRect().top;if(window.innerWidth>=780){if(navCoords<=-50){nav.style.position='fixed';nav.style.top='20px';nav.style.width='20%';}else{nav.style.position='static';nav.style.width='auto';}}else{nav.style.position='absolute';nav.style.top='';nav.style.width='auto';}}
function _initActive(){var posts=document.querySelectorAll('.article__title'),postLinks=document.querySelectorAll('.blog-menu__link'),activeLink=document.getElementsByClassName('blog-menu__link_active');for(var i=0;i<posts.length;i++){var post=posts[i],postTop=post.getBoundingClientRect().top;if(postTop<=100){activeLink[0].classList.remove('blog-menu__link_active');postLinks[i].classList.add('blog-menu__link_active');}}}
var _openMenu=function(){sidebar.classList.add('blog__tabs-active');};var _closeMenu=function(){sidebar.classList.remove('blog__tabs-active');};return{init:_fixMenu,initActive:_initActive,toggle:function(){if(!sidebar.classList.contains('blog__tabs-active')){_openMenu();}
else{_closeMenu();}}}})();var mainParallax=(function(){var _show=function(){var parallaxContainer=document.getElementById('parallax'),layers=parallaxContainer.children;window.addEventListener('mousemove',function(e){var pageX=e.pageX,pageY=e.pageY,initialX=(window.innerWidth/2)-pageX,initialY=(window.innerHeight/2)-pageY;[].slice.call(layers).forEach(function(layer,i){var layerStyle=layer.style,divider=i/40,bottomPosition=(window.innerHeight/2)*divider,horizontalPosition=(window.innerWidth/2)*divider,positionX=initialX*divider,positionY=initialY*divider,transformString='translate3d('+positionX+'px,'+positionY+'px, 0)';layerStyle.transform=transformString;layerStyle.webkitTransform=transformString;layerStyle.bottom='-'+bottomPosition+'px';layerStyle.left='-'+horizontalPosition+'px';layerStyle.right='-'+horizontalPosition+'px';})});};return{init:_show};})();var preloader=(function(){var percentsTotal=0;var preloader=$('.preloader');var imgPath=$('*').map(function(ndx,element){var background=$(element).css('background-image');var isImg=$(element).is('img');var path='';if(background!='none'){path=background.replace('url("','').replace('")','');}
if(isImg){path=$(element).attr('src');}
if(path)return path;});var setPercents=function(total,current){var percents=Math.ceil(current/total*100);$('.preloader__percent').text(percents+'%');if(percents=100){preloader.fadeOut();}};var loadImages=function(images){if(!images.length)preloader.fadeOut();images.forEach(function(img,i,images){var fakeImage=$('<img>',{attr:{src:img}});fakeImage.on('load error',function(){percentsTotal++;setPercents(images.length,percentsTotal);});});};return{init:function(){var imgs=imgPath.toArray();loadImages(imgs);}}}());$(function(){preloader.init();});var ScrollPage=(function(){return{down:function(elem){var section=elem.parentNode.nextSibling.nextSibling,posTop=section.offsetTop;$('body,html').animate({scrollTop:posTop},1500);},up:function(){$('body,html').animate({scrollTop:0},1200);}}})();var skillsDraw=(function(){var skills=document.querySelectorAll('.skill'),circles=document.querySelectorAll('.skills__circle-above'),windowHeight=window.innerHeight;var circleLength=function(circle){var circleRadius=circle.getAttribute('r'),circleLength=2*Math.PI*circleRadius;return circleLength;};[].slice.call(circles).forEach(function(circle){circle.style.strokeDashoffset=circleLength(circle);circle.style.strokeDasharray=circleLength(circle);});var circleAnimation=function(skill){var circleFill=skill.querySelector('.skills__circle-above'),skillPercent=skill.getAttribute('data-percent'),length=circleLength(circleFill),percent=length*(100-skillPercent)/100;setTimeout(function(){circleFill.style.strokeDashoffset=percent;circleFill.style.transition='all 1s';if(skillPercent<50){skill.style.opacity=0.4;skill.style.transition='all 1s';}},500);};return{grow:function(){[].slice.call(skills).forEach(function(skill){var circleRect=skill.getBoundingClientRect(),circlePos=circleRect.bottom,startAnimation=circlePos-windowHeight;if(startAnimation<=0){circleAnimation(skill);}});}}})();var Slider=(function(){var items=$('.work-slider__item','.work-slider__list_next'),index=1,ndx,duration=500,title=$('.work__title'),skills=$('.work__technology'),imgContainer=$('.work__pic');function _init(){var activeItem=items.eq(index),imgSrc=activeItem.find('img').attr('src'),activeTitle=activeItem.data('title'),activeSlill=activeItem.data('technology');imgContainer.attr('src',imgSrc);title.text(activeTitle);skills.text(activeSlill);var nextItem=$('.work-slider__item','.work-slider__list_next').eq(index+1);nextItem.addClass('work-slider__item_current');var prevItem=$('.work-slider__item','.work-slider__list_prev').eq(index-1);prevItem.addClass('work-slider__item_current');}
function animateSlide(ndx,container,direction){var nextItems=$('.work-slider__item',container),currentItem=nextItems.filter('.work-slider__item_current'),reqItem=nextItems.eq(ndx);direction=direction==='up'?-100:100;currentItem.animate({'top':direction+'%'},duration);reqItem.animate({'top':0},duration,function(){currentItem.removeClass('work-slider__item_current').css('top',-direction+'%');reqItem.addClass('work-slider__item_current');})}
function _moveNext(){var container=$('.work-slider__list_next'),direction='up';if(index==items.length-1){ndx=0;}else if(index<0){ndx=items.length-1;}else{ndx=index+1;}
animateSlide(ndx,container,direction);}
function _movePrev(){var container=$('.work-slider__list_prev'),direction='down';if(index>items.length-1){ndx=0;}else if(index<=0){ndx=items.length-1;}else{ndx=index-1;}
animateSlide(ndx,container,direction);}
function _slideShow(){var fadedOut=$.Deferred(),loaded=$.Deferred(),nextSrc=items.eq(index).find('img').attr('src'),nextTitle=items.eq(index).data('title'),nextSkills=items.eq(index).data('technology');_moveNext();_movePrev();imgContainer.fadeOut(function(){title.slideUp();skills.fadeOut();fadedOut.resolve();});fadedOut.done(function(){title.text(nextTitle);skills.text(nextSkills);imgContainer.attr('src',nextSrc).on('load',function(){loaded.resolve();})});loaded.done(function(){title.slideDown();skills.fadeIn();imgContainer.fadeIn();});}
return{init:_init,move:function(){$('.toggle__link').on('click',function(e){e.preventDefault();if($(this).hasClass('toggle__link_next')){index++;}else if($(this).hasClass('toggle__link_prev')){index--;}
if(index>items.length-1){index=0;}else if(index<0){index=items.length-1;}
_slideShow();})}}})();const formUpload=document.querySelector('#upload');function fileUpload(url,data,cb){let xhr=new XMLHttpRequest();xhr.open('POST',url,true);xhr.onload=function(e){let result=JSON.parse(xhr.responseText);cb(result.status);};xhr.send(data);}
function prepareSendFile(e){e.preventDefault();let resultContainer=document.querySelector('.status');let formData=new FormData();let file=document.querySelector('#file-select').files[0];let name=document.querySelector('#file-desc').value;formData.append('photo',file,file.name);formData.append('name',name);resultContainer.innerHTML='Uploading...';fileUpload('/upload',formData,function(data){resultContainer.innerHTML=data;});}
if(formUpload){formUpload.addEventListener('submit',prepareSendFile);}
const formMail=document.querySelector('#mail');if(formMail){formMail.addEventListener('submit',prepareSendMail);}
function prepareSendMail(e){e.preventDefault();let resultContainer=document.querySelector('.status');let data={name:formMail.name.value,email:formMail.email.value,text:formMail.text.value};resultContainer.innerHTML='Sending...';sendAjaxJson('/contact-me',data,function(data){resultContainer.innerHTML=data;});}
function sendAjaxJson(url,data,cb){let xhr=new XMLHttpRequest();xhr.open('POST',url,true);xhr.setRequestHeader('Content-Type','application/json');xhr.onload=function(e){let result=JSON.parse(xhr.responseText);cb(result.status);};xhr.send(JSON.stringify(data));}
const formBlog=document.querySelector('#blog');if(formBlog){formBlog.addEventListener('submit',prepareSendPost);}
function prepareSendPost(e){e.preventDefault();let resultContainer=document.querySelector('.status');let data={title:formBlog.title.value,date:formBlog.date.value,text:formBlog.text.value};resultContainer.innerHTML='Sending...';sendAjaxJson('/addpost',data,function(data){resultContainer.innerHTML=data;});}
const formLogin=document.querySelector('#login');if(formLogin){formLogin.addEventListener('submit',prepareAuth);}
function prepareAuth(e){e.preventDefault();let resultContainer=document.querySelector('.status');let data={login:formLogin.login.value,password:formLogin.password.value};resultContainer.innerHTML='Sending...';sendAjaxJson('/',data,function(data){resultContainer.innerHTML=data;});}
var preload=document.querySelector('.preloader');if(preload!==null)preloader.init();window.onload=function(){var parallax=document.querySelector('#parallax');if(parallax!==null){mainParallax.init();}
var slider=document.querySelector('.work__slider');if(slider!==null){(function(){Slider.init();Slider.move();})();}
var form=document.querySelector('form');if(form!==null){var inputs=form.elements;var closeError=document.querySelector('.input-error-captcha__close');for(var i=0;i<inputs.length;i++){inputs[i].onfocus=function(){if(this.parentNode.classList.contains('input-group_error')){Validation.clear(this);}}}
if(closeError!==null){closeError.onclick=function(){closeError.parentNode.parentNode.style.display='none';};}
form.addEventListener('submit',function(e){e.preventDefault();var valid=Validation.init(form);console.log(valid);})}
var bg=document.querySelector('.bg-parallax'),skills=document.querySelector('.skill'),blogWrapper=document.querySelector('.blog-container');window.onscroll=function(){var wScroll=window.pageYOffset;if(bg!==null){headerParallax.init(wScroll);}
if(skills!==null){skillsDraw.grow();}
if(blogWrapper!==null){BlogMenu.init();BlogMenu.initActive();}};var sideMenu=document.querySelector('.sidemenu-btn');if(sideMenu!==null){sideMenu.onclick=function(){BlogMenu.toggle();}}
window.onresize=function(){BlogMenu.init();}
var scrollDown=document.querySelector('.arrow');var scrollUp=document.querySelector('.arrow-up');if(scrollDown!==null){scrollDown.addEventListener('click',function(e){e.preventDefault();ScrollPage.down(this);})}
if(scrollUp!==null){scrollUp.addEventListener('click',function(e){e.preventDefault();ScrollPage.up(this);})}};